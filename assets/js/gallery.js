function toggleAll(e){const t=document.getElementsByClassName("file-checkbox"),n=e.textContent.includes("Select All");for(let e of t)e.checked=n;e.innerHTML=n?"‚úó Deselect All":"‚úì Select All",updateDeleteButton()}function updateDeleteButton(){const e=document.getElementsByClassName("file-checkbox"),t=document.getElementById("delete-button"),n=document.getElementById("select-all-button");let l=0,c=e.length;for(let t of e)t.checked&&l++;t.disabled=0===l,0===l?n.innerHTML="‚úì Select All":l===c&&(n.innerHTML="‚úó Deselect All")}function confirmDelete(){const e=Array.from(document.getElementsByClassName("file-checkbox")).filter(e=>e.checked).map(e=>e.value);if(0===e.length)return showToast("No files selected","error"),void hideDeleteDialog();document.getElementById("delete-dialog").style.display="block",document.getElementById("delete-dialog-overlay").style.display="block"}function hideDeleteDialog(){document.getElementById("delete-dialog").style.display="none",document.getElementById("delete-dialog-overlay").style.display="none"}function proceedWithDelete(){const e=Array.from(document.getElementsByClassName("file-checkbox")).filter(e=>e.checked).map(e=>e.value);if(0===e.length)return showToast("No files selected","error"),void hideDeleteDialog();document.getElementById("selected-files").value=JSON.stringify(e);const t=document.getElementById("delete-form");t.onsubmit=null;const n=new URLSearchParams(window.location.search);const currentPage=n.get('page')||'1';const pageInput=document.createElement('input');pageInput.type='hidden';pageInput.name='return_page';pageInput.value=currentPage;t.appendChild(pageInput);t.submit(),hideDeleteDialog()}function showToast(e,t="info",n=3e3){const l=document.getElementById("toast-container"),c=document.createElement("div");c.className=`toast ${t}`,c.style.animation="slideIn 0.3s ease-out";let o="üîî";switch(t){case"success":o="‚úÖ";break;case"error":o="‚ùå";break;case"warning":o="‚ö†"}c.innerHTML=`<span class="toast-icon">${o}</span><span class="toast-message">${e}</span>`,l.appendChild(c),setTimeout(()=>{c.style.animation="slideOut 0.3s ease-out forwards",setTimeout(()=>{l.removeChild(c)},300)},n)}function sortGallery(e){const t=document.querySelector(".gallery-grid, .gallery-list"),n=Array.from(t.children);n.sort((t,n)=>{const[l,c]=e.split("-"),o="asc"===c?1:-1;if("date"===l){const e=t.querySelector(".filedate").textContent.replace("Date: ",""),l=n.querySelector(".filedate").textContent.replace("Date: ","");return o*(new Date(e).getTime()-new Date(l).getTime())}if("name"===l){const e=t.querySelector(".filename").textContent.toLowerCase(),l=n.querySelector(".filename").textContent.toLowerCase();return o*e.localeCompare(l)}return 0}),n.forEach(e=>t.appendChild(e))}function setView(e){const t=document.querySelector(".gallery-grid, .gallery-list"),n=document.getElementById("grid-view"),l=document.getElementById("list-view");"grid"===e?t.className="gallery-grid":t.className="gallery-list",n.classList.toggle("button-primary","grid"===e),l.classList.toggle("button-primary","list"===e),localStorage.setItem("gallery-view",e)}function showUploadDialog(){document.getElementById("upload-dialog").style.display="flex",initDragDrop()}function hideUploadDialog(){document.getElementById("upload-dialog").style.display="none"}function initDragDrop(){const e=document.getElementById("drop-zone");function t(e){e.preventDefault(),e.stopPropagation()}function n(t){e.classList.add("upload-zone-active")}function l(t){e.classList.remove("upload-zone-active")}function c(e){const t=new FormData;Array.from(e).forEach(e=>{t.append("files[]",e)});const n=document.querySelector('meta[name="secret-key"]').getAttribute("content");t.append("secret_key",n),fetch("upload.php",{method:"POST",body:t}).then(e=>e.text()).then(e=>{let t;try{t=JSON.parse(e)}catch(e){throw console.error("JSON parse error:",e),new Error("Invalid JSON response from server")}t.success?(showToast("Files uploaded successfully","success"),hideUploadDialog(),location.reload()):showToast(t.error||"Upload failed","error")}).catch(e=>{showToast("Upload failed: "+e.message,"error")})}["dragenter","dragover","dragleave","drop"].forEach(n=>{e.addEventListener(n,t,!1)}),e.addEventListener("click",()=>{const e=document.createElement("input");e.type="file",e.multiple=!0,e.accept=".jpg,.jpeg,.png,.gif,.mp4,.webm",e.onchange=e=>c(e.target.files),e.click()}),e.addEventListener("drop",e=>{c(e.dataTransfer.files)}),["dragenter","dragover"].forEach(t=>{e.addEventListener(t,n,!1)}),["dragleave","drop"].forEach(t=>{e.addEventListener(t,l,!1)})}function handlePaginationClick(e){e.preventDefault();const url=e.target.href;if(url){showToast("Loading page...","info",1000);window.location.href=url}}function initPagination(){const paginationContainers=document.querySelectorAll('.pagination-bottom');paginationContainers.forEach(container=>{container.addEventListener('click',e=>{if(e.target.classList.contains('pagination-link')&&!e.target.classList.contains('pagination-current')){handlePaginationClick(e)}})})}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("delete-form");e&&(e.onsubmit=function(e){e.preventDefault(),confirmDelete()});const t=localStorage.getItem("gallery-view")||"grid";setView(t);initPagination()});
